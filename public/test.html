<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Run Tests</title>
  <style>
    .test-result {
      margin-top: 20px;
    }
    .test-result .test-case {
      margin-bottom: 10px;
    }
    .test-result .test-case .test-error {
      color: red;
    }
    .test-result .test-case .test-success {
      color: green;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.4.0/mocha.min.css">
</head>
<body>
  <h1>Run Tests</h1>
  <button id="run-tests">Run Tests</button>
  <div id="mocha"></div>
  <div id="test-results" class="test-result"></div>

  <!-- Load Mocha and Chai -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.4.0/mocha.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.3.4/chai.min.js"></script>
  <!-- Load Superagent -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/6.1.0/superagent.min.js"></script>
  <!-- Test Script -->
  <script>
    document.getElementById('run-tests').addEventListener('click', runTests);

    async function runTests() {
      const resultsContainer = document.getElementById('test-results');
      resultsContainer.innerHTML = '';

      // Define Mocha and Chai
      mocha.setup('bdd');
      const { assert } = chai;

      // Test cases
      describe('API Tests', () => {
        it('should register a new user', async function() {
          try {
            const res = await superagent.post('/register').send({
              username: 'testuser',
              password: 'password123'
            });
            assert.equal(res.status, 200);
            assert.hasAllKeys(res.body, ['id']);
            appendResult('should register a new user', 'Success');
          } catch (error) {
            appendResult('should register a new user', error.message, true);
          }
        });

        it('should log in a user', async function() {
          try {
            const res = await superagent.post('/login').send({
              username: 'testuser',
              password: 'password123'
            });
            assert.equal(res.status, 200);
            assert.hasAllKeys(res.body, ['id']);
            appendResult('should log in a user', 'Success');
          } catch (error) {
            appendResult('should log in a user', error.message, true);
          }
        });

        it('should submit a question', async function() {
          try {
            const res = await superagent.post('/submit_question').send({
              question: 'What is the capital of France?',
              type: 'text',
              category: 'geography',
              answer: 'Paris',
              creator: 'testuser'
            });
            assert.equal(res.status, 200);
            assert.hasAllKeys(res.body, ['id']);
            appendResult('should submit a question', 'Success');
          } catch (error) {
            appendResult('should submit a question', error.message, true);
          }
        });
      });

      // Run Mocha
      mocha.run();

      // Helper function to append results to the DOM
      function appendResult(testName, message, isError) {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'test-case';
        const resultMessage = document.createElement('p');
        resultMessage.textContent = testName + ': ' + message;
        resultMessage.className = isError ? 'test-error' : 'test-success';
        resultDiv.appendChild(resultMessage);
        resultsContainer.appendChild(resultDiv);
      }
    }
  </script>
</body>
</html>
